(this["webpackJsonptest-app"]=this["webpackJsonptest-app"]||[]).push([[18],{356:function(e,t,a){"use strict";function n(e,t){var a=e.auth,n=e.lists,i=e.paths,r=n["user_grants/".concat(a.uid)],l=i["admins/".concat(a.uid)];if(!0!==a.isAuthorised)return!1;if(!0===l)return!0;if(void 0!==r){var o=!0,c=!1,s=void 0;try{for(var u,d=r[Symbol.iterator]();!(o=(u=d.next()).done);o=!0){var p=u.value;if(p.key===t)return!0===p.val}}catch(m){c=!0,s=m}finally{try{o||null==d.return||d.return()}finally{if(c)throw s}}}return!1}function i(e,t){if(void 0!==t){var a=!0,i=!1,r=void 0;try{for(var l,o=t[Symbol.iterator]();!(a=(l=o.next()).done);a=!0){if(!0===n(e,l.value))return!0}}catch(c){i=!0,r=c}finally{try{a||null==o.return||o.return()}finally{if(i)throw r}}}return!1}a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}))},378:function(e,t,a){"use strict";var n=a(2),i=a(809),r=a(499),l=a(0),o=a.n(l),c=function(e){var t=e.src,a=(e.iconName,e.icon),l=Object(n.a)(e,["src","iconName","icon"]);return t?o.a.createElement(r.a,null,o.a.createElement(i.a,Object.assign({src:t},l))):o.a.createElement(r.a,null,o.a.createElement(i.a,l,a))};a.d(t,"a",(function(){return c}))},395:function(e,t,a){"use strict";var n="".concat("DIALOGS","@ON_DIALOG_OPEN_CHANGED");function i(e,t){return{type:n,id:e,isOpen:t}}a.d(t,"a",(function(){return i}))},524:function(e,t,a){"use strict";var n=a(2),i=a(0),r=a.n(i),l=a(798);t.a=function(e){var t=e.label,a=e.input,i=e.meta,o=i.touched,c=i.invalid,s=i.error,u=Object(n.a)(e,["label","input","meta"]);return r.a.createElement(l.a,Object.assign({label:t,placeholder:t,error:o&&c,helperText:o&&s},a,u))}},799:function(e,t,a){"use strict";a.r(t);var n=a(302),i=a(46),r=a(304),l=a(305),o=a(306),c=a(82),s=a(393),u=a.n(s),d=a(553),p=a(565),m=a(502),h=a(566),f=a(793),b=a(792),v=a(0),g=a.n(v),y=a(496),E=a(794),O=a(11),j=a(25),_=a(267);function C(e,t){return{type:"dialogs@ON_SIMPLE_VALUE_CHANGED",id:e,value:t}}function S(e){return g.a.createElement(y.a,Object.assign({direction:"up"},e))}var M=function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(r.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).handleClose=function(){var e=a.props,t=e.deleteKey;(0,e.setSimpleValue)(t,void 0)},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.intl,n=t.isDialogOpen,i=t.handleDelete,r=t.name,l=t.fullScreen,o=t.deleteUid;return n?g.a.createElement(p.a,{fullScreen:l,open:n,onClose:this.handleClose,TransitionComponent:S,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},g.a.createElement(b.a,{id:"alert-dialog-title"},a.formatMessage({id:"delete_".concat(r,"_title")})),g.a.createElement(h.a,null,g.a.createElement(f.a,{id:"alert-dialog-description"},a.formatMessage({id:"delete_".concat(r,"_message")}))),g.a.createElement(m.a,null,g.a.createElement(d.a,{onClick:this.handleClose,color:"primary"},a.formatMessage({id:"cancel"})),g.a.createElement(d.a,{onClick:function(){i(e.handleClose,o)},color:"secondary"},a.formatMessage({id:"delete"})))):null}}]),t}(v.Component),U=Object(O.d)(Object(j.b)((function(e,t){var a=e.simpleValues,n=t.name,i="delete_".concat(n),r=!(!a||!a[i]);return{deleteUid:!!a&&a[i],deleteKey:i,isDialogOpen:r}}),{setSimpleValue:C}),Object(E.a)(),_.b)(M),k=a(12),w=a(261),D=function(e){return Object.keys(e).forEach((function(t){return void 0===e[t]&&delete e[t]})),e},x=function(e,t){var a=t.handleCreateValues;return void 0!==a&&a instanceof Function?a(e):e},A=function(e,t){var a=t.handleUpdateValues;return void 0!==a&&a instanceof Function?a(e):e},P=function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(r.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={initialized:!1},a.handleSubmit=function(e){var t=a.props,n=t.path,i=t.uid,r=t.firebaseApp,l=t.useFirestore;if(i){var o=A(D(e),a.props);o&&(l?r.firestore().collection(n).doc(i).update(o):r.database().ref().child("".concat(n).concat(i)).update(o))}else{var c=x(D(e),a.props);c&&(l?r.firestore().collection(n).doc().set(c):r.database().ref().child("".concat(n)).push(c))}},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.path,n=t.uid,i=t.name,r=t.firebaseApp,l=t.initialize,o=t.useFirestore;n?o?this.unsub=r.firestore().collection(a).doc(n).onSnapshot((function(t){t.exists&&e.setState({initialized:!0},(function(){l(i,t.data(),!0)}))}),(function(e){console.log("Encountered error: ".concat(e))})):r.database().ref("".concat(a).concat(n)).on("value",(function(t){e.setState({initialized:!0},(function(){l(i,t.val(),!0)}))})):this.setState({initialValues:{},initialized:!0})}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.path,a=e.uid;e.firebaseApp.database().ref("".concat(t).concat(a)).off(),this.unsub&&this.unsub()}},{key:"render",value:function(){return g.a.Children.only(g.a.cloneElement(this.props.children,Object(k.a)({onSubmit:this.handleSubmit},this.state,{},this.props)))}}]),t}(v.Component),L=Object(j.b)((function(e){return{}}),{initialize:w.b})(P),z=a(282),R=a(722),I=a.n(R),N=a(81),V=a(578),F=a(356),G=a(22),T=a(763),q=function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(r.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o))))._handleDelete=function(e){var t=a.props,n=(t.history,t.match);t.firebaseApp,t.path,n.params.uid},a.hanldeSubmitSuccess=function(){var e=a.props,t=e.history,n=e.path;t.push("/".concat(n))},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.history,a=e.setSimpleValue,n=e.intl,i=e.submit,r=e.match,l=e.isGranted,o=e.firebaseApp,s=e.children,d=e.fireFormProps,p=e.handleDelete,m=e.name,h=e.path,f=r.params.uid;return g.a.createElement(c.a,Object.assign({title:n.formatMessage({id:f?"edit_".concat(m):"create_".concat(m)}),appBarContent:g.a.createElement("div",{style:{display:"flex"}},(void 0!==f&&l("edit_".concat(m))||void 0===f&&l("create_".concat(m)))&&g.a.createElement(V.a,{title:n.formatMessage({id:"save"})},g.a.createElement(z.a,{color:"inherit","aria-label":"save",onClick:function(){i(m)}},g.a.createElement(I.a,null))),f&&l("delete_".concat(m))&&g.a.createElement(V.a,{title:n.formatMessage({id:"delete"})},g.a.createElement(z.a,{color:"inherit","aria-label":"delete",onClick:function(){a("delete_".concat(m),!0)}},g.a.createElement(u.a,null)))),onBackClick:function(){t.goBack()}},this.props),g.a.createElement(N.a,{style:{height:"calc(100vh - 112px)"}},g.a.createElement("div",{style:{margin:15,display:"flex"}},g.a.createElement(L,Object.assign({firebaseApp:o,name:m,path:"/".concat(h,"/"),uid:f,onSubmitSuccess:this.hanldeSubmitSuccess},d),s))),g.a.createElement(U,{name:m,handleDelete:p||this._handleDelete}))}}]),t}(v.Component),B=Object(O.d)(Object(j.b)((function(e,t){var a=e.auth,n=e.intl,i=t.isGranted;return{auth:a,intl:n,isGranted:function(t){return i?i(e,t):Object(F.a)(e,t)}}}),{setSimpleValue:C,change:w.a,submit:w.c}),_.b,G.g,T.a)(q),H=a(322),W=a(2),J=a(378),K=function(e){e.label;var t=e.input,a=e.meta,n=(a.touched,a.invalid,a.error,Object(W.a)(e,["label","input","meta"]));return g.a.createElement(J.a,Object.assign({src:t?t.value:void 0},t,n))},Q=a(731),X=a.n(Q),Y=a(576),Z=a(280),$=a(568),ee=a(389),te=a.n(ee),ae=a(762),ne=a(281),ie=a(284),re=a(724),le=function(e){return g.a.createElement(y.a,Object.assign({direction:"up"},e))},oe=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(l.a)(t).call(this,e))).handlePhotoURLUpload=function(e){var t=a.props;t.path,t.fileName,t.onUploadSuccess,t.firebaseApp;a.setState({isUploading:!0,uploadProgress:0})},a.handlePhotoULRChange=function(e){var t=new FileReader;t.onload=function(){a.setState({src:t.result,file:e[0]})},t.readAsDataURL(e[0])},a.handleClose=function(){var e=a.props.handleClose;a.setState({src:void 0}),e()},a.cropper=null,a.state={src:void 0,isUploading:!1,uploadProgress:0,file:{}},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.intl,n=t.open,i=t.title,r=t.theme,l=t.cropperProps,o=this.state,c=o.src,s=o.uploadProgress,u=o.isUploading;return g.a.createElement(p.a,{fullScreen:!0,TransitionComponent:le,open:n,onClose:this.handleClose,"aria-labelledby":"responsive-dialog-title"},g.a.createElement(Z.a,{style:{position:"relative"}},g.a.createElement(ne.a,null,g.a.createElement(z.a,{edge:"start",color:"inherit",onClick:this.handleClose,"aria-label":"close"},g.a.createElement(te.a,null)),g.a.createElement(ie.a,{style:{marginLeft:r.spacing(2),flex:1},variant:"h6"},i),g.a.createElement(d.a,{color:"inherit",disabled:!c||u,onClick:function(){e.handlePhotoURLUpload(e.cropper.crop())}},a.formatMessage({id:"save"})))),g.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"}},!c&&!u&&g.a.createElement(ae.a,{onDrop:this.handlePhotoULRChange},(function(t){var n=t.getRootProps,i=t.getInputProps;return g.a.createElement("div",Object.assign({},n(),{style:c?void 0:{height:"50vh",width:"50vw",display:"flex",alignItems:"center",justifyContent:"center",borderStyle:"dashed",borderColor:r.palette.secondary.main}}),g.a.createElement("input",i()),g.a.createElement(ie.a,null,c?e.state.file.name:a.formatMessage({id:"drop_or_select_file_label"})))})),u&&g.a.createElement("div",null,g.a.createElement($.a,{variant:"static",value:s,style:{width:200,height:200},size:50,thickness:20})),c&&!u&&g.a.createElement("div",{style:{maxWidth:"80vw",maxHeight:"80vh"}},g.a.createElement(re.Cropper,Object.assign({ref:function(t){e.cropper=t},src:this.state?c:void 0,aspectRatio:1},l)))))}}]),t}(v.Component),ce=Object(O.d)(T.a,_.b)(oe),se=function(e){var t=e.icon,a=e.disabled,n=e.initialized,i=e.intl,r=e.path,l=e.uid,o=e.name,c=e.change,s=e.cropperProps,u=Object(v.useState)(void 0),d=Object(H.a)(u,2),p=d[0],m=d[1];return g.a.createElement("div",{style:{margin:20,display:"flex",flexDirection:"column",alignItems:"center"}},g.a.createElement("div",null,g.a.createElement(Y.a,{name:o,style:{width:120,height:120,fontSize:60},component:K,icon:t||g.a.createElement(X.a,{fontSize:"large"})})),g.a.createElement("div",null,g.a.createElement(z.a,{style:{width:"100%"},onClick:function(){m("true")},disabled:!0===a||(void 0===l||!n),color:"primary"},g.a.createElement(X.a,null))),g.a.createElement(ce,{path:"".concat(r,"/").concat(l),fileName:o,onUploadSuccess:function(e){e.ref.getDownloadURL().then((function(e){c(o,e),m(void 0)}))},open:void 0!==p,src:p,handleClose:function(){m(void 0)},title:i.formatMessage({id:"change_photo"}),cropperProps:s}))},ue=a(88),de=a.n(ue),pe=a(524),me=a(577),he=a(579),fe=a(395),be=function(e){function t(){return Object(n.a)(this,t),Object(r.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.handleSubmit,n=t.intl,i=t.initialized,r=t.setDialogIsOpen,l=t.dialogs,o=t.match.params.uid;return g.a.createElement("form",{onSubmit:a,style:{height:"100%",width:"100%",alignItems:"strech",display:"flex",flexWrap:"wrap",justifyContent:"center"}},g.a.createElement("button",{type:"submit",style:{display:"none"}}),g.a.createElement("div",{style:{margin:15,display:"flex",flexDirection:"column"}},g.a.createElement(se,{name:"photoURL",disabled:!i,uid:o,change:this.props.change,initialized:i,icon:g.a.createElement(de.a,{fontSize:"large"}),intl:n,path:"companies"}),g.a.createElement("div",null,g.a.createElement(Y.a,{name:"name",disabled:!i,component:pe.a,placeholder:n.formatMessage({id:"name_hint"}),label:n.formatMessage({id:"name_label"})})),g.a.createElement("div",null,g.a.createElement(Y.a,{name:"full_name",disabled:!i,component:pe.a,placeholder:n.formatMessage({id:"full_name_hint"}),label:n.formatMessage({id:"full_name_label"})})),g.a.createElement("div",null,g.a.createElement(Y.a,{name:"vat",disabled:!i,component:pe.a,placeholder:n.formatMessage({id:"vat_hint"}),label:n.formatMessage({id:"vat_label"})})),g.a.createElement("div",null,g.a.createElement(Y.a,{name:"description",disabled:!i,component:pe.a,multiline:!0,rows:2,placeholder:n.formatMessage({id:"description_hint"}),label:n.formatMessage({id:"description_label"})})),g.a.createElement(ce,{path:"companies/".concat(o),fileName:"photoURL",onUploadSuccess:function(t){e.handlePhotoUploadSuccess(t)},open:void 0!==l.new_company_photo,src:l.new_company_photo,handleClose:function(){r("new_company_photo",void 0)},title:n.formatMessage({id:"change_photo"})})))}}]),t}(v.Component);be=Object(me.a)({form:"company"})(be);var ve=Object(he.a)("company"),ge=Object(j.b)((function(e){return{intl:e.intl,vehicleTypes:e.vehicleTypes,users:e.users,dialogs:e.dialogs,photoURL:ve(e,"photoURL")}}),{setDialogIsOpen:fe.a})(Object(_.b)(Object(G.g)(Object(T.a)(be))));t.default=Object(_.b)((function(e){var t=e.intl;return g.a.createElement(B,{name:"company",path:"companies",fireFormProps:{validate:function(e){var a={};return a.name=e.name?"":t.formatMessage({id:"error_required_field"}),a.full_name=e.full_name?"":t.formatMessage({id:"error_required_field"}),a.vat=e.vat?"":t.formatMessage({id:"error_required_field"}),a}}},g.a.createElement(ge,e))}))}}]);